<h3>hi <%=current_user.name%></h3>
<%= render 'posts/form' %>

<%= link_to "coupon list", user_coupons_path(current_user) %>
<div id="activities">
 <%= render_activities(@activities, layout: '/shared/activity') %>
 
</div>


<h2>Can be followed</h2>
重新整理才會看到按鈕生效<br>
<%#User.all.each do |user|%>
<%#if user==current_user%>
<%#else%>
	<%#=user.name%>
	<%#= render partial:'follows/form', locals: { user: user } %>
	<%= render(@followers) || render('shared/no_resource', resources: 'Followers')  %>
<%#end%>
<br>
<%#end%>




<h2>following </h2>
<%current_user.all_follows.each do |followers|%>
<%=User.find(followers.followable_id).name%>
<br>
<%end%>


<br>

<%= render 'shared/paginate', resources: @activities %>

  <script>

var pusher = new Pusher('9f9b0db2bcf535c9126b', {disableStats: true } ); // uses your APP KEY
var channel = pusher.subscribe("private-"+<%=current_user.id%>);
channel.bind('greet', function(data) {
  var new_activity=data.comment;
  console.log(new_activity);

  
  $.ajax({
    url:'/commenters/'+data.comment.id,
    success:function(html){ $('#activities').prepend(html);console.log(html)},
    error: function(xhr) {alert('Ajax request 發生錯誤');console.log(xhr)}
    //http://stackoverflow.com/questions/31143415/rendering-an-object-passed-through-pusher-in-rails
  });

});



// Some useful debug msgs
        pusher.connection.bind('connecting', function() {
          console.log('Connecting to Pusher...');
        });
        pusher.connection.bind('connected', function() {
          console.log('Connected to Pusher!');
        });
        pusher.connection.bind('failed', function() {
          console.log('Connection to Pusher failed :(');
        });
        channel.bind('subscription_error', function(status) {
          console.log('Pusher subscription_error');
        });
  </script>